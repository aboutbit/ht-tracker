name: Health Reminders

on:
  schedule:
    - cron: '0 23 * * *'  # 08:00 KST - ë¹„íŠ¸ì¦™
    - cron: '0 0 * * *'   # 09:00 KST - í˜ˆì•• ì¸¡ì •
    - cron: '0 4 * * *'   # 13:00 KST - ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜
    - cron: '0 6 * * *'   # 15:00 KST - ë¹„íŠ¸ì¦™
    - cron: '0 10 * * *'  # 19:00 KST - ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜ + ì˜¤ë©”ê°€3
    - cron: '0 12 * * *'  # 21:00 KST - í˜ˆì•• ì¸¡ì •
  workflow_dispatch:
    inputs:
      hour_override:
        description: 'UTC hour to simulate (00-23), leave empty for current time'
        required: false

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Determine reminder
        id: reminder
        run: |
          if [ -n "${{ github.event.inputs.hour_override }}" ]; then
            HOUR="${{ github.event.inputs.hour_override }}"
          else
            HOUR=$(date -u +%H)
          fi

          echo "Current UTC hour: $HOUR"

          case "$HOUR" in
            "23")
              TITLE="ðŸ¥¤ ë¹„íŠ¸ì¦™ ë¨¹ê¸°"
              MSG="ì˜¤ì „ 8ì‹œ - ë¹„íŠ¸ì¦™ ë¨¹ì„ ì‹œê°„ìž…ë‹ˆë‹¤!"
              ;;
            "00")
              TITLE="ðŸ©º í˜ˆì•• ì¸¡ì •"
              MSG="ì˜¤ì „ 9ì‹œ - í˜ˆì•• ì¸¡ì •í•  ì‹œê°„ìž…ë‹ˆë‹¤!"
              ;;
            "04")
              TITLE="ðŸ’Š ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜"
              MSG="ì˜¤í›„ 1ì‹œ - ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜ ì˜ì–‘ì œ ë“œì„¸ìš”!"
              ;;
            "06")
              TITLE="ðŸ¥¤ ë¹„íŠ¸ì¦™ ë¨¹ê¸°"
              MSG="ì˜¤í›„ 3ì‹œ - ë¹„íŠ¸ì¦™ ë¨¹ì„ ì‹œê°„ìž…ë‹ˆë‹¤!"
              ;;
            "10")
              TITLE="ðŸ’Š ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜ + ì˜¤ë©”ê°€3"
              MSG="ì˜¤í›„ 7ì‹œ - ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜ ì˜ì–‘ì œì™€ ì˜¤ë©”ê°€3 ë“œì„¸ìš”!"
              ;;
            "12")
              TITLE="ðŸ©º í˜ˆì•• ì¸¡ì •"
              MSG="ì˜¤í›„ 9ì‹œ - í˜ˆì•• ì¸¡ì •í•  ì‹œê°„ìž…ë‹ˆë‹¤!"
              ;;
            *)
              echo "No reminder scheduled for UTC hour $HOUR"
              exit 0
              ;;
          esac

          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "msg=$MSG" >> $GITHUB_OUTPUT

      - name: Send ntfy notification
        if: steps.reminder.outputs.title != ''
        run: |
          curl -s -X POST \
            -H "Title: ${{ steps.reminder.outputs.title }}" \
            -H "Priority: high" \
            -H "Tags: bell" \
            -d "${{ steps.reminder.outputs.msg }}" \
            https://ntfy.sh/find-phone-aa9d807aae2602d6ad24
          echo "Notification sent: ${{ steps.reminder.outputs.title }}"
